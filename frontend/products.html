<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products - Orders Management</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <nav class="navbar">
        <div class="container navbar-content">
            <div class="navbar-brand">Orders App</div>
            <div class="navbar-menu">
                <a href="products.html" class="navbar-link">Products</a>
                <a href="cart.html" class="navbar-link" style="position: relative;">
                    Cart
                    <span id="cart-badge" class="cart-badge" style="display: none;">0</span>
                </a>
                <a href="orders.html" class="navbar-link">My Orders</a>
                <a href="#" onclick="app.logout()" class="navbar-link">Logout</a>
            </div>
        </div>
    </nav>

    <div class="container" style="margin-top: 2rem;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <h1>Product Catalog</h1>
            <div style="display: flex; gap: 1rem;">
                <input type="text" id="search-input" class="form-input" placeholder="Search products..."
                    style="width: 300px;">
                <select id="category-filter" class="form-input" style="width: 200px;">
                    <option value="">All Categories</option>
                </select>
            </div>
        </div>

        <div id="products-grid" class="grid grid-3">
            <!-- Products will be loaded here -->
        </div>
    </div>

    <script src="js/app.js"></script>
    <script>
        let allProducts = [];

        async function loadProducts() {
            try {
                app.showLoading();
                const data = await app.getProducts();
                allProducts = data.products;
                renderProducts(allProducts);
                await loadCategories();
                await app.getCart(); // Load cart for badge
                app.hideLoading();
            } catch (error) {
                app.hideLoading();
                app.showAlert('Failed to load products: ' + error.message, 'error');
            }
        }

        async function loadCategories() {
            const categories = [...new Set(allProducts.map(p => p.category).filter(c => c))];
            const select = document.getElementById('category-filter');
            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                select.appendChild(option);
            });
        }

        function renderProducts(products) {
            const grid = document.getElementById('products-grid');

            if (products.length === 0) {
                grid.innerHTML = '<p class="text-center text-muted">No products found</p>';
                return;
            }

            grid.innerHTML = products.map(product => `
                <div class="card">
                    <img src="${product.image_url || 'https://via.placeholder.com/300x200?text=Product'}" 
                         alt="${product.name}" class="product-image">
                    <h3>${product.name}</h3>
                    <p class="text-muted" style="font-size: 0.875rem; margin-bottom: 1rem;">
                        ${product.description || 'No description'}
                    </p>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <span class="product-price">${app.formatCurrency(product.price)}</span>
                        <span class="badge ${product.stock_quantity > 0 ? 'badge-success' : 'badge-danger'}">
                            ${product.stock_quantity > 0 ? 'In Stock' : 'Out of Stock'}
                        </span>
                    </div>
                    <button onclick="addProductToCart(${product.id})" 
                            class="btn btn-primary" 
                            style="width: 100%;"
                            ${product.stock_quantity === 0 ? 'disabled' : ''}>
                        Add to Cart
                    </button>
                </div>
            `).join('');
        }

        async function addProductToCart(productId) {
            try {
                await app.addToCart(productId, 1);
                app.showAlert('Product added to cart!', 'success');
            } catch (error) {
                app.showAlert('Failed to add to cart: ' + error.message, 'error');
            }
        }

        // Search and filter
        document.getElementById('search-input').addEventListener('input', (e) => {
            filterProducts();
        });

        document.getElementById('category-filter').addEventListener('change', (e) => {
            filterProducts();
        });

        function filterProducts() {
            const search = document.getElementById('search-input').value.toLowerCase();
            const category = document.getElementById('category-filter').value;

            let filtered = allProducts;

            if (search) {
                filtered = filtered.filter(p =>
                    p.name.toLowerCase().includes(search) ||
                    (p.description && p.description.toLowerCase().includes(search))
                );
            }

            if (category) {
                filtered = filtered.filter(p => p.category === category);
            }

            renderProducts(filtered);
        }

        // Load products on page load
        loadProducts();
    </script>
</body>

</html>